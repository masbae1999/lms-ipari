/**
 *
 * @package    local_mb2megamenu
 * @copyright  2018 - 2022 Mariusz Boloz (mb2moodle.com)
 * @license    Commercial https://themeforest.net/licenses
*/ var mb2megamenu_helper=function(){return{stripHtml:function(e){return null==e?e:e.replace(/<\/?[^>]+(>|$)/g,"")},modalShow:function(e){$(e).modal("show")},modalHide:function(e){$(e).modal("hide")}}};jQuery(document).ready(function(e){var t=e(document),a=e("#mb2megamenu-lang"),m=function(){var t=function(){i(e(".mb2megamenu-builder-area>.mb2megamenu-sortable>.mb2megamenu-item"),1),o(),l()},m=function(t,a,i){var o=t.find(">.mb2megamenu-item-content>.mb2megamenu-sortable>.mb2megamenu-item");o.length&&o.each(function(t){var i=n(e(this));return delete i.sortableItem,a.attr[t]={settings:i,attr:[]},m(e(this),a.attr[t]),a.attr[t]})},n=function(t){var a={};return e.each(t[0].attributes,function(){this.name.includes("data-")&&this.specified&&(a[this.name.replace("data-","")]=this.value)}),a},i=function(t,a){t.each(function(){e(this).attr("data-level",a);var t=e(this).find(">.mb2megamenu-item-content>.mb2megamenu-sortable>.mb2megamenu-item");t.length&&(i(t,++a),a-=1)})},o=function(){var t=e(".mb2megamenu-builder-area>.mb2megamenu-sortable>.mb2megamenu-item"),a=0;t.each(function(){var t=e(this);t.find(">.mb2megamenu-item-content>.mb2megamenu-sortable>.mb2megamenu-item").each(function(){a++}),t.attr("data-childnum",a),a=0})},s=function(e){var t="";return"lup"===e&&(t+='<button type="button" class="themereset" title="'+a.attr("data-levelup")+'" data-action="lup">',t+="</button>"),"ldown"===e&&(t+='<button type="button" class="themereset" title="'+a.attr("data-leveldown")+'" data-action="ldown">',t+="</button>"),"mup"===e&&(t+='<button type="button" class="themereset" title="'+a.attr("data-moveup")+'" data-action="mup">',t+="</button>"),"mdown"===e&&(t+='<button type="button" class="themereset" title="'+a.attr("data-movedown")+'" data-action="mdown">',t+="</button>"),t},l=function(){e(".mb2megamenu-item").each(function(){var t="",a=e(this).find(">.mb2megamenu-item-header .item-actions"),m=e(this).prev(".mb2megamenu-item").length,n=e(this).next(".mb2megamenu-item").length,i=e(this).attr("data-level")>1;m&&(t+=s("mup")),n&&(t+=s("mdown")),m&&(t+=s("lup")),i&&(t+=s("ldown")),a.html(t),t=""})};return{item_html:function(){var t="";return t+='<div class="mb2megamenu-item" data-level="1" data-label="'+a.attr("data-menuitem")+'">',t+='<div class="mb2megamenu-item-header">',t+='<div class="mb2megamenu-drag-handle mb2megamenu-item-label">',t+='<span class="item-label">'+a.attr("data-menuitem")+"</span>",t+='<div class="item-actions"></div>',t+='<button type="button" class="themereset mb2megamenu-item-form-toggle"><span class="sr-only">'+a.attr("data-edit")+"</span></button>",t+="</div>",t+="</div>",t+='<div class="mb2megamenu-item-content">',t+='<div class="mb2megamenu-item-subform">',t+='<div class="mb2megamenu-subform-item">',t+='<div class="form-label">',t+="<label>"+a.attr("data-url")+"</label>",t+="</div>",t+='<div class="form-controls">',t+='<input type="text" class="form-control code" name="url" value="" placeholder="https://">',t+="</div>",t+="</div>",t+='<div class="mb2megamenu-subform-item">',t+='<div class="form-controls">',t+='<input type="checkbox" name="blank" value="">',t+=" <label>"+a.attr("data-linktarget")+"</label>",t+="</div>",t+="</div>",t+='<div class="mb2megamenu-subform-item">',t+='<div class="form-label">',t+="<label>"+a.attr("data-navlabel")+"</label>",t+="</div>",t+='<div class="form-controls">',t+='<input type="text" name="label" class="form-control" value="'+a.attr("data-menuitem")+'">',t+="</div>",t+="</div>",t+='<div class="mb2megamenu-subform-item">',t+='<div class="form-controls">',t+='<button type="button" class="mb2megamenu-item-options mb2-pb-btn typeinfo sizexs" data-modal="#mb2megamenu-modal-settings">'+a.attr("data-menuitemopts")+"</button>",1==e("#mb2megamenu-modal-languages").attr("data-islangopt")&&(t+=' <button type="button" class="mb2megamenu-item-lang_options mb2-pb-btn sizexs" data-modal="#mb2megamenu-modal-languages">'+a.attr("data-languageopts")+"</button>"),t+="</div>",t+="</div>",t+='<div class="mb2megamenu-subform-footer">',t+='<button type="button" class="themereset mb2megamenu-item-footer-btn btn-remove">'+a.attr("data-remove")+"</button> | ",t+='<button type="button" class="themereset mb2megamenu-item-footer-btn btn-cancel">'+a.attr("data-cancel")+"</button>",t+="</div>",t+="</div>",t+='<div class="mb2megamenu-sortable mb2megamenu-item-sortable"></div>',t+="</div>",t+="</div>"},setData:function(){var t=[];return e(".mb2megamenu-main-sortable>.mb2megamenu-item").each(function(a){var i=n(e(this));delete i.sortableItem,t[a]={settings:i,attr:[]},m(e(this),t[a])}),t},mitemFormToggle:function(e){var t=e.closest(".mb2megamenu-item");t.hasClass("open")?t.removeClass("open"):t.addClass("open")},removeMenuItem:function(e){var m=e.closest(".mb2megamenu-item").find('[name="label"]').val();confirm(a.attr("data-remove")+": "+m+"?")&&(e.closest(".mb2megamenu-item").remove(),t())},setLayout:t}},n=function(){var m=function(e){var t="";return t+('<i class="'+e+'"></i>')},n=function(e){var t="";return t+('<img src="'+e+'?preview=thumb">')},i=function(e,t){e.focus(),e.spectrum({showInput:!0,showButtons:!1,preferredFormat:"rgb",allowEmpty:!0,color:"",showAlpha:!0})};return{setLabel:function(){t.on("keyup",'[name="label"]',function(){var t=e(this).closest(".mb2megamenu-item").find(">.mb2megamenu-item-header>.mb2megamenu-item-label>.item-label"),m=mb2megamenu_helper().stripHtml(e(this).val());""===m.replace(/\s/g,"")?t.text(a.attr("data-menuitem")):t.text(m)})},saveItemForm:function(){e(".mb2megamenu-subform-item input").each(function(){var t=e(this).closest(".mb2megamenu-item"),m=e(this).attr("name"),n=mb2megamenu_helper().stripHtml(e(this).val());"label"===e(this).attr("name")&&""===n.replace(/\s/g,"")&&(n=a.attr("data-menuitem")),"checkbox"===e(this).attr("type")&&(n=e(this).is(":checked")?1:0),t.attr("data-"+m,n)})},setItemForm:function(t){var m=t.closest(".mb2megamenu-item");m.find(">.mb2megamenu-item-content>.mb2megamenu-item-subform input").each(function(){var t=m.attr("data-"+e(this).attr("name"));"checkbox"===e(this).attr("type")?1==t?e(this).prop("checked",!0):e(this).prop("checked",!1):e(this).val(t),"label"===e(this).attr("name")&&(t=t||a.attr("data-menuitem"),m.find(">.mb2megamenu-item-header>.mb2megamenu-item-label .item-label").text(t))})},setIcon:function(t){var a=t.attr("data-iconname"),n=t.closest(".modal").attr("id");e("input.activefield").val(a),e("input.activefield").closest(".form-controls").find(".form-preview").html(m(a)),mb2megamenu_helper().modalHide("#"+n)},setImage:function(t){var a=t.attr("data-imgurl"),m=t.closest(".modal").attr("id");e("input.activefield").val(a),e("input.activefield").closest(".form-controls").find(".form-preview").html(n(a)),mb2megamenu_helper().modalHide("#"+m)},activateMenuItem:function(t){e(".mb2megamenu-item").removeClass("active"),t.closest(".mb2megamenu-item").addClass("active")},saveSettings:function(t){var a=e(".mb2megamenu-item.active");(t?e(".mb2megamenu-langform-item .form-control"):e(".mb2megamenu-input")).each(function(){var t=mb2megamenu_helper().stripHtml(e(this).val()),m=e(this).attr("name");"checkbox"===e(this).attr("type")&&(t=e(this).is(":checked")?1:0),a.attr("data-"+m,t)}),mb2megamenu_helper().modalHide(t?"#mb2megamenu-modal-languages":"#mb2megamenu-modal-settings")},setModalWindow:function(t){var a=t.closest(".mb2megamenu-item"),m=t.closest('[data-level="1"]'),n=e("#mb2megamenu-modal-settings");1==a.attr("data-level")?n.attr("data-id","mparent"):2==a.attr("data-level")&&1==m.attr("data-mega")?n.attr("data-id","mcolumn"):n.attr("data-id","mitem")},setModalWindowTitle:function(t,a){var m=t.closest(".mb2megamenu-item");e(t.attr("data-modal")).find(".modal-title").html((a?a+": ":"")+m.find(">.mb2megamenu-item-header>.mb2megamenu-item-label>.item-label").html())},searchItem:function(){e('.search-modal-item>input[type="text"]').each(function(){e(this).on("keyup",function(){var t=e(this).val().toLowerCase(),a=e(this).hasClass("mb2megamenu-search-image")?1:0,m=a?"data-simgname":"data-iconname";e(this).closest(a?".modal-body":".tab-pane").find(a?".mb2megamenu-image-toinsert":".mb2megamenu-icon-toinsert").each(function(){e(this).filter("["+m+'*="'+t+'"]').length>0||0==t.length?e(this).show():e(this).hide()})})})},setSettingsForm:function(){e(".form-preview").html("");var t=e(".mb2megamenu-item.active");e(".mb2megamenu-input").each(function(){var a=t.attr("data-"+e(this).attr("name")),o=void 0!==a?a:e(this).attr("data-value");e(this).hasClass("input-checkbox")?1==o?e(this).prop("checked",!0):e(this).prop("checked",!1):e(this).hasClass("input-image")&&o?(e(this).closest(".form-controls").find(".form-preview").html(n(o)),e(this).val(o)):e(this).hasClass("input-icon")&&o?(e(this).closest(".form-controls").find(".form-preview").html(m(o)),e(this).val(o)):e(this).hasClass("input-color")?(e(this).val(o),i(e(this),o)):e(this).val(o)})},setSettingsLanguagesForm:function(){var t=e(".mb2megamenu-item.active");e(".mb2megamenu-langform-item .form-control").each(function(){var a=t.attr("data-"+e(this).attr("name"));e(this).val(void 0!==a?a:"")})}}},i=function(){return{applyFileManager:function(t){window.onbeforeunload=null;var a=t.closest("#mb2megamenu-modal-file-manager").find('[data-fieldtype="filepicker"]');e("#mb2megamenu-modal-images").find(".mb2megamenu-images");var m=e("#mb2megamenu-modal-images").find(".mb2megamenu-overlay"),n=t.closest("#mb2megamenu-modal-file-manager").find("form"),i=t.closest("#mb2megamenu-modal-file-manager").find(".mb2-pb-uploadmedia-wrap").attr("data-url");if(!a.find(".filepicker-filename>a").length)return null;m.fadeIn(180),t.closest(".modal-footer").find('[data-dismiss="modal"]').trigger("click"),a.find(".filepicker-filename").empty(),e.ajax({type:"POST",url:i,dataType:"html",data:n.serialize(),beforeSend:function(){},error:function(e,t,a){},success:function(t){e("#mb2megamenu-modal-images").find(".mb2megamenu-images").html(t),e(".mb2megamenu-search-image").val(""),e(".mb2megamenu-search-image").trigger("keyup"),setTimeout(function(){m.fadeOut(250)},450)}})},removeFileManager:function(t){var a=e("#mb2megamenu-modal-images").find(".mb2megamenu-overlay"),m=t.closest(".mb2megamenu-images"),n=m.attr("data-url")+"?imgname="+t.closest(".mb2megamenu-image-toinsert").attr("data-imgname")+"&sesskey="+e(".mb2megamenu-builder-wrap").attr("data-sesskey");a.fadeIn(180),e.ajax({url:n,type:"get",dataType:"html",beforeSend:function(){},error:function(e,t,a){},success:function(t){m.html(t),e(".mb2megamenu-search-image").val(""),e(".mb2megamenu-search-image").trigger("keyup"),setTimeout(function(){a.fadeOut(250)},450)}})}}},o=function(){t.on("click","#mb2megamenu-add-menu-item",function(){e(".mb2megamenu-main-sortable").append(m().item_html()),m().setLayout()}),t.on("submit",'[role="main"]>form',function(){n().saveItemForm();var t=JSON.stringify(m().setData());e('input[name="menuitems"]').val(t)}),t.on("click",".mb2megamenu-item-form-toggle",function(){m().mitemFormToggle(e(this))}),t.on("click",".mb2megamenu-item-footer-btn.btn-remove",function(){m().removeMenuItem(e(this))}),t.on("click",".mb2megamenu-item-footer-btn.btn-cancel",function(){n().setItemForm(e(this)),m().mitemFormToggle(e(this))}),t.on("click","[data-modal]",function(){e(this).hasClass("mb2megamenu-activate-option")&&(e("#mb2megamenu-modal-settings").find("input").removeClass("activefield"),e(this).closest(".form-controls").find("input").addClass("activefield")),e(this).hasClass("mb2megamenu-item-options")&&(n().activateMenuItem(e(this)),n().setModalWindowTitle(e(this),a.attr("data-menuitemopts")),n().setModalWindow(e(this)),n().setSettingsForm()),e(this).hasClass("mb2megamenu-item-lang_options")&&(n().activateMenuItem(e(this)),n().setModalWindowTitle(e(this),a.attr("data-languageopts")),n().setSettingsLanguagesForm()),mb2megamenu_helper().modalShow(e(this).attr("data-modal"))}),t.on("click","[data-iconname]",function(){n().setIcon(e(this))}),t.on("click",".mb2megamenu-insert-image",function(){n().setImage(e(this))}),t.on("click",".mb2megamenu-fieldremove",function(){e(this).closest(".form-controls").find("input").val(""),e(this).closest(".form-controls").find(".form-preview").html("")}),t.on("click","#applay-file-manager",function(){i().applyFileManager(e(this))}),t.on("click",".imgremove",function(){i().removeFileManager(e(this))}),t.on("click",".mb2megamenu-modalbtn-save",function(){n().saveSettings(0)}),t.on("click",".mb2megamenu-lang_modalbtn-save",function(){n().saveSettings(1)}),t.on("click",'[data-action="mup"]',function(){var t=e(this).closest(".mb2megamenu-item");t.insertBefore(t.prev(".mb2megamenu-item")),m().setLayout()}),t.on("click",'[data-action="mdown"]',function(){var t=e(this).closest(".mb2megamenu-item");t.insertAfter(t.next(".mb2megamenu-item")),m().setLayout()}),t.on("click",'[data-action="lup"]',function(){var t=e(this).closest(".mb2megamenu-item");t.prev(".mb2megamenu-item").find(">.mb2megamenu-item-content>.mb2megamenu-sortable").append(t),m().setLayout()}),t.on("click",'[data-action="ldown"]',function(){var t=e(this).closest(".mb2megamenu-item"),a=t.attr("data-level")-1,n=t.closest('[data-level="'+a+'"]');t.insertAfter(n),m().setLayout()})};({init:function(){o(),m().setLayout(),n().setLabel(),n().searchItem()}}).init()});
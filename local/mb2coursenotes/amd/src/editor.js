/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2022 Mariusz Boloz (https://mb2themes.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery"],function(e){var t,n,a=e(".mb2-editor-document"),r=e(".mb2-editor-textarea"),i=function(e){e||(e=o()),a.empty(),a.append(c(e)),""===a.html()&&a.html(o())},o=function(){return"<p><br></p>"},l=function(){var t=a.clone();t.find('[id^="yui"]').each(function(){e(this).removeAttr("id")}),t.find('*[class=""]').each(function(){e(this).removeAttr("class")});var n=t.html();return"<p></p>"===n||"<p><br></p>"===n?"":n},c=function(e){return d(e,[{regex:/<!--(?![\s\S]*?-->)/gi,replace:""},{regex:/<\/?(?:title|meta|style|script|st\d|head|font|html|body|link)[^>]*?>/gi,replace:""}])},d=function(e,t){var n=0;for(n=0;n<t.length;n++)e=e.replace(t[n].regex,t[n].replace);return e},s=function(e){u();var t=e,n=t.data("action"),a=!1,r=null;t.data("show-default-ui")&&(a=t.data("show-default-ui")),t.data("value-args")&&(r=t.data("value-args")),document.execCommand(n,a,r)},u=function(){a.focus()},m=function(e){e.val()&&document.execCommand("formatBlock",!1,"<"+e.val()+">")},f=function(){var t=e(".note-form-field");r.hasClass("editing")?(i(r.val()),r.removeClass("editing"),t.removeClass("source")):(p(),r.addClass("editing"),t.addClass("source"))},p=function(){r.val(""),textarea_value=l(),r.val(textarea_value)},h=function(){var t=e(".mb2-editor");t.hasClass("showhelper")?t.removeClass("showhelper"):t.addClass("showhelper")},v=function(){var r=e(".mb2-editor-helper-element");n=(t=window.getSelection()).getRangeAt(0);var i=a.find("a.active");i.length&&(r.find('input[name="mb2_editor_link_url"]').val(i.attr("href")),"_blank"===i.attr("target")&&(r.find('input[name="mb2_editor_link_target"]').checked=!0))},g=function(){e('input[name="mb2_editor_link_url"]').val(""),e('input[name="mb2_editor_link_target"]').checked=!1,a.find("a").removeClass("active")},b=function(t){var n=t.closest(".mb2-editor-helper-element"),r=n.find('input[name="mb2_editor_link_url"]').val(),i=n.find('input[name="mb2_editor_link_target"]'),o=a.find("a.active");r&&(C(r,i,o),e(".mb2-editor").removeClass("showhelper"),g())},k=function(t){e(".mb2-editor").removeClass("showhelper"),g()},C=function(e,t,a){u();var r=n;a.length?(a.attr("href",e),t.prop("checked")?a.attr("target","_blank"):a.removeAttr("target")):(link=document.createElement("a"),r.collapsed?link.appendChild(document.createTextNode(e)):link.appendChild(document.createTextNode(r.toString())),link.setAttribute("href",e),t.prop("checked")?link.setAttribute("target","_blank"):link.removeAttribute("target"),r.deleteContents(),r.insertNode(link))},x=function(){e(document).on("click",".mb2-editor button",function(){e(this).hasClass("mb2-editor-htmlmode")?f(e(this)):s(e(this))}),e(document).on("change",'.mb2-editor select[data-action="formatBlock"]',function(){m(e(this))}),e(document).on("click",".mb2-editor-helper-link",function(){h(),v()}),e(document).on("click",".mb2-editor-document a",function(t){t.preventDefault(),a.find("a").removeClass("active"),e(this).addClass("active"),h(),v()}),e(document).on("click",".mb2-editor-link-save",function(t){b(e(this))}),e(document).on("click",".mb2-editor-link-cancel",function(t){k(e(this))})};return{initEditor:function(e){document.queryCommandSupported("DefaultParagraphSeparator")&&document.execCommand("DefaultParagraphSeparator",!1,"p"),i(e),a.attr("contenteditable","true")},updateFromTextareaBeforeSave:function(){r.hasClass("editing")&&i(r.val())},getCleanHtml:l,buttonActions:s,formatBlock:m,toggleMode:f,toggleHelper:h,setLinkForm:v,linkSave:b,linkCancel:k,editorActions:x,updateFromEditor:p,stripHtml:function(e){return e=(e=(e=(e=e.replace(/<\/?[^>]+(>|$)/g,"")).replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"")).replace(/\s+/g,"")).replace(/&nbsp;/g,"")}}});
/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2022 Mariusz Boloz (https://mb2themes.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
 */ define(["jquery","core/ajax"],function(t,e){var o=function(e){s(e.content,!0)&&t(".mb2coursenotes_modal").addClass("isnote"),t("#mb2coursenotes_modal_form_content").val(e.content),t(".mb2coursenotes_modal_btn_save").attr("data-itemid",e.id),t(".mb2coursenotes_modal_btn_delete").attr("data-itemid",e.id),t(".mb2coursenotes_openform").attr("data-itemid",e.id),setTimeout(function(){t("#mb2coursenotes_modal_form").removeClass("loading")},600)},a=function(e){t("#mb2coursenotes_modal_form").modal("hide"),t("#user-notifications").html(e.message)},n=function(){t(".mb2coursenotes_modal_btn_save").attr("data-itemid",0),t(".mb2coursenotes_modal_btn_delete").attr("data-itemid",0),t(".mb2coursenotes_openform").attr("data-itemid",0)},r=function(){t("#mb2coursenotes_modal_form_content").addClass("required")},s=function(t,e){return t=t.replace(/<\/?[^>]+(>|$)/g,""),e&&(t=(t=(t=t.replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"")).replace(/\s+/g,"")).replace(/&nbsp;/g,"")),t};return{openForm:function(){t(document).on("click",".mb2coursenotes_openform",function(){var a=t(this),n=a.attr("data-itemid"),r=a.attr("data-module"),s=a.attr("data-user"),m=a.attr("data-course");t("#mb2coursenotes_modal_form").modal("show"),t("#mb2coursenotes_modal_form").addClass("loading"),e.call([{methodname:"local_mb2coursenotes_get_note",args:{itemid:n,module:r,user:s,course:m},done:function(t){o(t)}}])})},saveNote:function(){t(document).on("click",".mb2coursenotes_modal_btn_save",function(){var o=t(this),n=o.attr("data-itemid"),m=o.attr("data-user"),d=o.attr("data-course"),c=o.attr("data-module"),i=t("#mb2coursenotes_modal_form_content").val();if(""===s(i,!0))return r(),null;t("#mb2coursenotes_modal_form_content").removeClass("required");var u={methodname:"local_mb2coursenotes_edit_note",args:{itemid:n,user:m,content:s(i,!1)},done:function(t){a(t)}};0==n&&(u={methodname:"local_mb2coursenotes_add_note",args:{user:m,course:d,module:c,content:i},done:function(t){a(t)}}),e.call([u])[0]})},deleteNote:function(){t(document).on("click",".mb2coursenotes_modal_btn_delete",function(){var o=t(this),r=o.attr("data-itemid"),s=o.attr("data-user");confirm(o.attr("data-confirmtext"))&&(request={methodname:"local_mb2coursenotes_delete_note",args:{itemid:r,user:s},done:function(t){a(t),n()}},e.call([request])[0])})}}});
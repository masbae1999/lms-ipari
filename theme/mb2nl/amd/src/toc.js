/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2024 Mariusz Boloz (lmsstyle.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery","core/ajax","core/notification"],function(t,e,a){"use strict";let s=t("#page"),o=t(".coursetoc-sectionlist-content"),i=t=>{(t=>{let a={courseid:t,viewhidden:s.attr("data-viewhidden")};return e.call([{methodname:"theme_mb2nl_course_enrolment_modules",args:a}])[0]})(t).then(t=>{o.append(t.sections),n()}).catch(a.exception)},c=t=>{(t=>{let a={courseid:t,modid:s.attr("data-mod_id"),sid:s.attr("data-mod_sid"),ptype:s.attr("data-ptype"),playout:s.attr("data-playout"),uparamsection:s.attr("data-uparam_section"),uparamid:s.attr("data-uparam_id")};return e.call([{methodname:"theme_mb2nl_course_modules",args:a}])[0]})(t).then(t=>{o.append(t.sections),n(),r()}).catch(a.exception)};var n=function(){t(".coursetoc-section-toggle").click(function(e){var a=t(this).closest(".coursetoc-section");a.hasClass("active")?(a.removeClass("active"),t(this).attr("aria-expanded","false")):(a.addClass("active"),t(this).attr("aria-expanded","true"))})},r=function(){var e=t(".coursetoc-sectionlist"),a=e.find("li.active"),s=e.find(".coursetoc-section.active");if(!a.length&&!s.length)return null;var o=(a.length?a:s).offset().top,i=t(window).height(),c=Math.ceil(o-i+i/3);c>0&&t(".sidebar-content-inner").scrollTop(c)},l=function(t,e){var a=t.find(".itemname").text();(a=a.toLowerCase()).trim().indexOf(e)>-1||0==e.length?(t.removeClass("hbyjs"),t.addClass("sbyjs")):(t.addClass("hbyjs"),t.removeClass("sbyjs"))},d=function(t,e){t.find(".sbyjs").length||0==e.length?(t.addClass("sbyjs"),t.removeClass("hbyjs")):(t.removeClass("sbyjs"),t.addClass("hbyjs"))};return{courseTocLoad:c,enrolmentTocLoad:i,shortcodeToc:function(){t(".theme-toc").closest(".generalbox").find("h3,h4,h5,h6").each(function(){var e=t(this).html().replace(/[^a-z0-9]/gi,"_");t(this).attr("id",e.trim())})},toggleAll:function(){t(".coursetoc-toggleall").click(function(e){var a=t(this).closest(".coursetoc-tools").length?t(".tgsdb-toc"):t(this).closest(".block_coursetoc"),s=a.find(".coursetoc-section"),o=a.find(".coursetoc-section-toggle"),i=!t(this).hasClass("toctool-toggleall");t(this).hasClass("collapsed")?(s.addClass("active"),o.attr("aria-expanded","true"),t(this).attr("aria-expanded","true"),t(this).attr("aria-label",mb2nljs.collapseall),t(this).removeClass("collapsed"),i?t(this).text(mb2nljs.collapseall):t(this).find("i").attr("class","bi bi-chevron-contract")):(s.removeClass("active"),o.attr("aria-expanded","false"),t(this).attr("aria-expanded","false"),t(this).attr("aria-label",mb2nljs.expandall),t(this).addClass("collapsed"),i?t(this).text(mb2nljs.expandall):t(this).find("i").attr("class","bi bi-chevron-expand"))})},searchToc:function(){t(".coursetoc-search form").on("submit",function(t){t.preventDefault()}),t('[name="coursetoc-sinput"').on("keyup",function(){var e=t(this).val().trim().toLowerCase();t(".coursetoc-section").each(function(){var a=t(this);t(this).find(".module-item").each(function(){var a;l(t(this),e)}),d(a,e)})})}}});